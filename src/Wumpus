#!/usr/bin/java --source 17

import java.util.LinkedHashSet;
import java.util.List;
import java.util.Set;
import java.util.random.RandomGenerator;
import java.util.stream.Collectors;

public class Wumpus {
  private final Game game = new Game();

  public static void main(String[] args) {
    var wumpus = new Wumpus();
    wumpus.startGame();
    wumpus.describeRoom();
  }

  private void startGame(){
    game.startGame();
    System.out.println("Hunt the wumpus");
    System.out.println();
  }

  private void describeRoom() {
    var room = game.describeRoom();
    System.out.println("You are in room " + room.number());
    var tunnels = room.tunnelsLeadTo().stream()
      .map(String::valueOf)
      .collect(Collectors.joining(", "));
    System.out.println("Tunnels lead to " + tunnels);
    for (var e : room.warnings()) {
      switch (e) {
        case WUMPUS -> System.out.println("I smell a wumpus!");
        case BOTTOMLESS_PIT -> System.out.println("I feel a draft");
        case SUPER_BAT -> System.out.println("Bats nearby!");
      }
    }
  }
}

class Game {
  private final List<Set<Integer>> cave = List.of(
    Set.of(2, 5, 8),
    Set.of(1, 3, 10),
    Set.of(2, 4, 12),
    Set.of(3, 5, 14),
    Set.of(1, 4, 6),
    Set.of(5, 7, 15),
    Set.of(6, 8, 17),
    Set.of(1, 7, 9),
    Set.of(8, 10, 18),
    Set.of(2, 9, 11),
    Set.of(10, 12, 19),
    Set.of(3, 11, 13),
    Set.of(12, 14, 20),
    Set.of(4, 13, 15),
    Set.of(6, 14, 16),
    Set.of(15, 17, 20),
    Set.of(7, 16, 18),
    Set.of(9, 17, 19),
    Set.of(11, 18, 20),
    Set.of(13, 16, 19)
  );

  private static final int PLAYER = 0;
  private static final int WUMPUS = 1;
  private static final int BOTTOMLESS_PIT_1 = 2;
  private static final int BOTTOMLESS_PIT_2 = 3;
  private static final int SUPER_BAT_1 = 4;
  private static final int SUPER_BAT_2 = 5;
  private final int[] items = new int[6];

  private final RandomGenerator randomGenerator = RandomGenerator.of("Xoroshiro128PlusPlus");

  void startGame() {
    do {
      positionPlayer();
      positionWumpus();
      positionBottomlessPits();
      positionSuperBats();
    } while (checkForCrossovers());
  }

  private void positionPlayer() {
    items[PLAYER] = randomRoom();
  }

  private void positionWumpus() {
    items[WUMPUS] = randomRoom();
  }

  private void positionBottomlessPits() {
    items[BOTTOMLESS_PIT_1] = randomRoom();
    items[BOTTOMLESS_PIT_2] = randomRoom();
  }

  private void positionSuperBats() {
    items[SUPER_BAT_1] = randomRoom();
    items[SUPER_BAT_2] = randomRoom();
  }

  private boolean checkForCrossovers() {
    for (var i = 0; i < items.length; i++) {
      for (var j = 0; j < items.length; j++) {
        if (i == j) {
          continue;
        }
        if (items[i] == items[j]) {
          return true;
        }
      }
    }
    return false;
  }

  private int randomRoom() {
    return randomGenerator.nextInt(1, 21);
  }

  void movePlayer() {}

  void shootCrookedArrow() {}

  RoomDescription describeRoom() {
    var number = playersRoom();
    var tunnelsLeadTo = reachableRoomsFrom(number);
    var warnings = exploreRooms(tunnelsLeadTo);
    return new RoomDescription(number, tunnelsLeadTo, warnings);
  }

  private Set<Warning> exploreRooms(Set<Integer> tunnelsLeadTo) {
    var warnings = new LinkedHashSet<Warning>();
    if (tunnelsLeadTo.contains(items[WUMPUS])) {
      warnings.add(Warning.WUMPUS);
    }
    if (tunnelsLeadTo.contains(items[BOTTOMLESS_PIT_1])
        || tunnelsLeadTo.contains(items[BOTTOMLESS_PIT_2])) {
      warnings.add(Warning.BOTTOMLESS_PIT);
    }
    if (tunnelsLeadTo.contains(items[SUPER_BAT_1]) || tunnelsLeadTo.contains(items[SUPER_BAT_2])) {
      warnings.add(Warning.SUPER_BAT);
    }
    return Set.copyOf(warnings);
  }

  private Set<Integer> reachableRoomsFrom(int number) {
    return cave.get(number - 1);
  }

  private int playersRoom() {
    return items[PLAYER];
  }

  private record Room(int number, Set<Integer> tunnelsLeadTo) {}
}

record RoomDescription(int number, Set<Integer> tunnelsLeadTo, Set<Warning> warnings) {}

enum Warning {
  WUMPUS,
  BOTTOMLESS_PIT,
  SUPER_BAT,
}
